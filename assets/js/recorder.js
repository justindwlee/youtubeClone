(()=>{"use strict";var e,t={m:{},u:e=>"js/"+e+".js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var a=r.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=a[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e+"../"})(),t.b=document.baseURI||self.location.href,function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(e||(e={}));const r=(()=>{let e=0;return()=>e++})(),a=(new Error("unknown message type"),new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first")),n=new Error("called FFmpeg.terminate()");new Error("failed to import ffmpeg-core.js");class i{#e=null;#t={};#r={};#a=[];#n=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=t=>{let{data:{id:r,type:a,data:n}}=t;switch(a){case e.LOAD:this.loaded=!0,this.#t[r](n);break;case e.MOUNT:case e.UNMOUNT:case e.EXEC:case e.FFPROBE:case e.WRITE_FILE:case e.READ_FILE:case e.DELETE_FILE:case e.RENAME:case e.CREATE_DIR:case e.LIST_DIR:case e.DELETE_DIR:this.#t[r](n);break;case e.LOG:this.#a.forEach((e=>e(n)));break;case e.PROGRESS:this.#n.forEach((e=>e(n)));break;case e.ERROR:this.#r[r](n)}delete this.#t[r],delete this.#r[r]})};#s=(()=>{var e=this;return function(t){let{type:n,data:i}=t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2?arguments[2]:void 0;return e.#e?new Promise(((t,a)=>{const l=r();e.#e&&e.#e.postMessage({id:l,type:n,data:i},s),e.#t[l]=t,e.#r[l]=a,o?.addEventListener("abort",(()=>{a(new DOMException(`Message # ${l} was aborted`,"AbortError"))}),{once:!0})})):Promise.reject(a)}})();on(e,t){"log"===e?this.#a.push(t):"progress"===e&&this.#n.push(t)}off(e,t){"log"===e?this.#a=this.#a.filter((e=>e!==t)):"progress"===e&&(this.#n=this.#n.filter((e=>e!==t)))}load=(()=>{var r=this;return function(){let{classWorkerURL:a,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{signal:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.#e||(r.#e=a?new Worker(new URL(a,"file:///home/justin/youtubeClone/youtubeClone/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(new URL(t.p+t.u(607),t.b),{type:void 0}),r.#i()),r.#s({type:e.LOAD,data:n},void 0,i)}})();exec=(()=>{var t=this;return function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.#s({type:e.EXEC,data:{args:r,timeout:a}},void 0,n)}})();ffprobe=(()=>{var t=this;return function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.#s({type:e.FFPROBE,data:{args:r,timeout:a}},void 0,n)}})();terminate=()=>{const e=Object.keys(this.#r);for(const t of e)this.#r[t](n),delete this.#r[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(()=>{var t=this;return function(r,a){let{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=[];return a instanceof Uint8Array&&i.push(a.buffer),t.#s({type:e.WRITE_FILE,data:{path:r,data:a}},i,n)}})();mount=(t,r,a)=>this.#s({type:e.MOUNT,data:{fsType:t,options:r,mountPoint:a}},[]);unmount=t=>this.#s({type:e.UNMOUNT,data:{mountPoint:t}},[]);readFile=(()=>{var t=this;return function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.#s({type:e.READ_FILE,data:{path:r,encoding:a}},void 0,n)}})();deleteFile=(()=>{var t=this;return function(r){let{signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.#s({type:e.DELETE_FILE,data:{path:r}},void 0,a)}})();rename=(()=>{var t=this;return function(r,a){let{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.#s({type:e.RENAME,data:{oldPath:r,newPath:a}},void 0,n)}})();createDir=(()=>{var t=this;return function(r){let{signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.#s({type:e.CREATE_DIR,data:{path:r}},void 0,a)}})();listDir=(()=>{var t=this;return function(r){let{signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.#s({type:e.LIST_DIR,data:{path:r}},void 0,a)}})();deleteDir=(()=>{var t=this;return function(r){let{signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.#s({type:e.DELETE_DIR,data:{path:r}},void 0,a)}})()}var s;!function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"}(s||(s={})),new Error("failed to get response body reader"),new Error("failed to complete download");const o=document.getElementById("actionBtn"),l=document.getElementById("preview");let d,c,E;const p="recording.webm",u="output.mp4",h="thumbnail.jpg",g=(e,t)=>{const r=document.createElement("a");r.href=e,r.download=t,document.body.appendChild(r),r.click()},f=async()=>{o.removeEventListener("click",f),o.innerText="Transcoding...",o.disabled=!0;const e=new i;await e.load(),await e.writeFile(p,await(async e=>{let t;if("string"==typeof e)t=/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(",")[1]).split("").map((e=>e.charCodeAt(0))):await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else{if(!(e instanceof File||e instanceof Blob))return new Uint8Array;t=await(r=e,new Promise(((e,t)=>{const a=new FileReader;a.onload=()=>{const{result:t}=a;t instanceof ArrayBuffer?e(new Uint8Array(t)):e(new Uint8Array)},a.onerror=e=>{t(Error(`File could not be read! Code=${e?.target?.error?.code||-1}`))},a.readAsArrayBuffer(r)})))}var r;return new Uint8Array(t)})(E)),await e.exec(["-i",p,"-r","60",u]),await e.exec(["-i",p,"-ss","00:00:00","-frames:v","1",h]);const t=awaitffmpeg.readFile(u),r=awaitffmpeg.readFile(h),a=new Blob([t.buffer],{type:"video/mp4"}),n=new Blob([r.buffer],{type:"image/jpg"}),s=URL.createObjectURL(a),l=URL.createObjectURL(n);g(s,"MyVid.mp4"),g(l,"Thumbnail.jpg"),await e.deleteFile(p),await e.deleteFile(u),await e.deleteFile(h),o.disabled=!1,R(),o.innerText="Record Again",o.addEventListener("click",v),d.getTracks().forEach((e=>{e.stop()})),d=null},v=()=>{o.innerText="Recording",o.disabled=!0,o.removeEventListener("click",v),c=new MediaRecorder(d,{mimeType:"video/mp4"}),c.ondataavailable=e=>{E=URL.createObjectURL(e.data),console.log(E),l.srcObject=null,l.src=E,l.loop=!0,l.play(),o.innerText="Download",o.disabled=!1,o.addEventListener("click",f)},c.start(),setTimeout((()=>{c.stop()}),5e3)},R=async()=>{d=await navigator.mediaDevices.getUserMedia({audio:!1,video:{width:1024,height:576}}),console.log("Ready to Record!"),l.srcObject=d,l.play()};R(),o.addEventListener("click",v)})();