(()=>{const e=document.getElementById("videoContainer"),t=document.getElementById("commentForm"),n=document.querySelectorAll(".video__comment__deleteBtn"),a=async e=>{const t=e.target.parentElement,n=t.dataset.id;confirm("Are you sure you want to delete?")&&204===(await fetch(`/api/comments/${n}`,{method:"DELETE"})).status&&t.remove()};t&&(t.addEventListener("submit",(async t=>{t.preventDefault();const n=commentForm.querySelector("textarea"),o=n.value,c=e.dataset.id;if(""===o)return;const d=await fetch(`/api/videos/${c}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})});if(201===d.status){n.value="";const{newCommentId:e,user:t}=await d.json();((e,t,n)=>{const o=document.querySelector(".video__comments ul"),c=document.createElement("li"),d=document.createElement("span"),m=document.createElement("span"),r=document.createElement("img");d.innerText=` ${n.username}: ${e}`,m.innerText="❌",m.addEventListener("click",a),r.src=`/${n.avatarUrl}`,c.className="video__comment",c.dataset.id=t,c.appendChild(r),c.appendChild(d),c.appendChild(m),o.prepend(c)})(o,e,t)}})),n.forEach((e=>{e.addEventListener("click",a)})))})();